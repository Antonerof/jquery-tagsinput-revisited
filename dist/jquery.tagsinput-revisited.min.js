/* jQuery Tags Input Revisited Plugin

* Copyright (c) Krzysztof Rusnarczyk
* Licensed under the MIT license */
!function(a){var b=[],c=[];a.fn.addTag=function(f,g){return g=jQuery.extend({focus:!1,callback:!0,minChars:0,maxChars:null,limit:null,validationPattern:null},g),this.each(function(){var h=a(this).attr("id"),i=a(this).val().split(d(b[h]));if(""===i[0]&&(i=[]),f=jQuery.trim(f),g.unique&&a(this).tagExist(f)||!e(f,g,i,b[h]))return a("#"+h+"_tag").addClass("error"),!1;if(a("<span>").addClass("tag").append(a("<span>").text(f),a("<a>",{href:"#"}).click(function(){return a("#"+h).removeTag(encodeURI(f))})).insertBefore("#"+h+"_addTag"),i.push(f),a("#"+h+"_tag").val(""),g.focus?a("#"+h+"_tag").focus():a("#"+h+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,i),g.callback&&c[h]&&c[h].onAddTag){var j=c[h].onAddTag;j.call(this,f)}if(c[h]&&c[h].onChange){var k=i.length,j=c[h].onChange;j.call(this,a(this),i[k-1])}}),!1},a.fn.removeTag=function(e){return e=decodeURI(e),this.each(function(){var f=a(this).attr("id"),g=a(this).val().split(d(b[f]));a("#"+f+"_tagsinput .tag").remove();var h="";for(i=0;i<g.length;++i)g[i]!=e&&(h=h+d(b[f])+g[i]);if(a.fn.tagsInput.importTags(this,h),c[f]&&c[f].onRemoveTag){var j=c[f].onRemoveTag;j.call(this,e)}}),!1},a.fn.tagExist=function(c){var e=a(this).attr("id"),f=a(this).val().split(d(b[e]));return jQuery.inArray(c,f)>=0},a.fn.importTags=function(b){var c=a(this).attr("id");a("#"+c+"_tagsinput .tag").remove(),a.fn.tagsInput.importTags(this,b)},a.fn.tagsInput=function(e){var h=jQuery.extend({interactive:!0,placeholder:"Add a tag",minChars:0,maxChars:null,limit:null,validationPattern:null,width:"auto",height:"auto",autocomplete:null,hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0},e),i=0;return this.each(function(){if("undefined"==typeof a(this).data("tagsinput-init")){a(this).data("tagsinput-init",!0),h.hide&&a(this).hide();var e=a(this).attr("id");e&&!d(b[a(this).attr("id")])||(e=a(this).attr("id","tags"+(new Date).getTime()+i++).attr("id"));var j=jQuery.extend({pid:e,real_input:"#"+e,holder:"#"+e+"_tagsinput",input_wrapper:"#"+e+"_addTag",fake_input:"#"+e+"_tag"},h);b[e]=j.delimiter,(h.onAddTag||h.onRemoveTag||h.onChange)&&(c[e]=[],c[e].onAddTag=h.onAddTag,c[e].onRemoveTag=h.onRemoveTag,c[e].onChange=h.onChange);var k='<div id="'+e+'_tagsinput" class="tagsinput"><div id="'+e+'_addTag">';if(h.interactive&&(k=k+'<input id="'+e+'_tag" value="" placeholder="'+h.placeholder+'">'),a(k).insertAfter(this),a(j.holder).css("width",h.width),a(j.holder).css("min-height",h.height),a(j.holder).css("height",h.height),""!==a(j.real_input).val()&&a.fn.tagsInput.importTags(a(j.real_input),a(j.real_input).val()),!h.interactive)return this;a(j.fake_input).val(""),a(j.fake_input).data("pasted",!1),a(j.holder).on("click",j,function(b){a(b.data.fake_input).focus(),a(this).addClass("focus")}),a(j.fake_input).on("focus",j,function(b){a(j.holder).addClass("focus"),""===a(this).val()&&a(this).removeClass("error")}),a(j.fake_input).on("blur",j,function(b){a(j.holder).removeClass("focus")}),null!==h.autocomplete&&void 0!==jQuery.ui.autocomplete?(a(j.fake_input).autocomplete(h.autocomplete),a(j.fake_input).on("autocompleteselect",j,function(b,c){return a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:h.unique,minChars:h.minChars,maxChars:h.maxChars,limit:h.limit,validationPattern:h.validationPattern}),!1}),a(j.fake_input).on("keypress",j,function(b){a(this).autocomplete("close")})):a(j.fake_input).on("blur",j,function(b){return a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:h.unique,minChars:h.minChars,maxChars:h.maxChars,limit:h.limit,validationPattern:h.validationPattern}),!1}),a(j.fake_input).on("keypress",j,function(b){if(f(b))return b.preventDefault(),a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:h.unique,minChars:h.minChars,maxChars:h.maxChars,limit:h.limit,validationPattern:h.validationPattern}),!1}),a(j.fake_input).on("paste",function(){a(this).data("pasted",!0)}),a(j.fake_input).on("input",j,function(b){if(a(this).data("pasted")){a(this).data("pasted",!1);var c=a(b.data.fake_input).val();c=c.replace(/\n/g,""),c=c.replace(/\s/g,"");var d=g(b.data.delimiter,c);if(d.length>0){for(var e=0;e<d.length;++e)a(b.data.real_input).addTag(d[e],{focus:!0,unique:h.unique,minChars:h.minChars,maxChars:h.maxChars,limit:h.limit,validationPattern:h.validationPattern});return!1}}}),j.removeWithBackspace&&a(j.fake_input).on("keydown",function(b){if(8==b.keyCode&&""===a(this).val()){b.preventDefault();var c=a(this).closest(".tagsinput").find(".tag:last > span").text(),d=a(this).attr("id").replace(/_tag$/,"");a("#"+d).removeTag(encodeURI(c)),a(this).trigger("focus")}}),a(j.fake_input).keydown(function(b){jQuery.inArray(b.keyCode,[13,37,38,39,40,27,16,17,18,225])===-1&&a(this).removeClass("error")})}}),this},a.fn.tagsInput.updateTagsField=function(c,e){var f=a(c).attr("id");a(c).val(e.join(d(b[f])))},a.fn.tagsInput.importTags=function(d,e){a(d).val("");var f=a(d).attr("id"),h=g(b[f],e);for(i=0;i<h.length;++i)a(d).addTag(h[i],{focus:!1,callback:!1,minChars:0,maxChars:null,limit:null,validationPattern:null});if(c[f]&&c[f].onChange){var j=c[f].onChange;j.call(d,d,h[i])}};var d=function(a){return"undefined"==typeof a?a:"string"==typeof a?a:a[0]},e=function(b,c,d,e){var f=!0;return""===b&&(f=!1),b.length<c.minChars&&(f=!1),null!==c.maxChars&&b.length>c.maxChars&&(f=!1),null!==c.limit&&d.length>=c.limit&&(f=!1),null===c.validationPattern||c.validationPattern.test(b)||(f=!1),"string"==typeof e?b.indexOf(e)>-1&&(f=!1):a.each(e,function(a,c){return b.indexOf(c)>-1&&(f=!1),!1}),f},f=function(b){var c=!1;return 13===b.which||("string"==typeof b.data.delimiter?b.which===b.data.delimiter.charCodeAt(0)&&(c=!0):a.each(b.data.delimiter,function(a,d){b.which===d.charCodeAt(0)&&(c=!0)}),c)},g=function(b,c){if(""===c)return[];if("string"==typeof b){var d=c.split(b);return d.length>1?d:[]}var e="âˆž",f=c;a.each(b,function(a,b){f=f.split(b).join(e)});var d=f.split(e);return d.length>1?d:[]}}(jQuery);