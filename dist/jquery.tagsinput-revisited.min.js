!function(a){var b=[],c=[];a.fn.addTag=function(e,f){return f=jQuery.extend({focus:!1,callback:!0},f),this.each(function(){var g=a(this).attr("id"),h=a(this).val().split(b[g]);if(""===h[0]&&(h=[]),e=jQuery.trim(e),f.unique&&a(this).tagExist(e)||!d(e,f,h))return a("#"+g+"_tag").addClass("error"),!1;if(a("<span>").addClass("tag").append(a("<span>").text(e),a("<a>",{href:"#"}).click(function(){return a("#"+g).removeTag(encodeURI(e))})).insertBefore("#"+g+"_addTag"),h.push(e),a("#"+g+"_tag").val(""),f.focus?a("#"+g+"_tag").focus():a("#"+g+"_tag").blur(),a.fn.tagsInput.updateTagsField(this,h),f.callback&&c[g]&&c[g].onAddTag){var i=c[g].onAddTag;i.call(this,e)}if(c[g]&&c[g].onChange){var j=h.length,i=c[g].onChange;i.call(this,a(this),h[j-1])}}),!1},a.fn.removeTag=function(d){return d=decodeURI(d),this.each(function(){var e=a(this).attr("id"),f=a(this).val().split(b[e]);a("#"+e+"_tagsinput .tag").remove();var g="";for(i=0;i<f.length;++i)f[i]!=d&&(g=g+b[e]+f[i]);if(a.fn.tagsInput.importTags(this,g),c[e]&&c[e].onRemoveTag){var h=c[e].onRemoveTag;h.call(this,d)}}),!1},a.fn.tagExist=function(c){var d=a(this).attr("id"),e=a(this).val().split(b[d]);return jQuery.inArray(c,e)>=0},a.fn.importTags=function(b){var c=a(this).attr("id");a("#"+c+"_tagsinput .tag").remove(),a.fn.tagsInput.importTags(this,b)},a.fn.tagsInput=function(d){var g=jQuery.extend({interactive:!0,placeholder:"Add a tag",minChars:0,maxChars:null,limit:null,validationPattern:null,width:"auto",height:"auto",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0},d),h=0;return this.each(function(){if("undefined"==typeof a(this).data("tagsinput-init")){a(this).data("tagsinput-init",!0),g.hide&&a(this).hide();var d=a(this).attr("id");d&&!b[a(this).attr("id")]||(d=a(this).attr("id","tags"+(new Date).getTime()+h++).attr("id"));var i=jQuery.extend({pid:d,real_input:"#"+d,holder:"#"+d+"_tagsinput",input_wrapper:"#"+d+"_addTag",fake_input:"#"+d+"_tag"},g);b[d]=i.delimiter,(g.onAddTag||g.onRemoveTag||g.onChange)&&(c[d]=[],c[d].onAddTag=g.onAddTag,c[d].onRemoveTag=g.onRemoveTag,c[d].onChange=g.onChange);var j='<div id="'+d+'_tagsinput" class="tagsinput"><div id="'+d+'_addTag">';if(g.interactive&&(j=j+'<input id="'+d+'_tag" value="" placeholder="'+g.placeholder+'">'),a(j).insertAfter(this),a(i.holder).css("width",g.width),a(i.holder).css("min-height",g.height),a(i.holder).css("height",g.height),""!==a(i.real_input).val()&&a.fn.tagsInput.importTags(a(i.real_input),a(i.real_input).val()),!g.interactive)return this;if(a(i.fake_input).val(""),a(i.holder).on("click",i,function(b){a(b.data.fake_input).focus(),a(this).addClass("focus")}),a(i.fake_input).on("blur",i,function(b){a(i.holder).removeClass("focus")}),void 0!==g.autocomplete_url){var k={source:g.autocomplete_url};for(attrname in g.autocomplete)k[attrname]=g.autocomplete[attrname];void 0!==jQuery.Autocompleter?(a(i.fake_input).autocomplete(g.autocomplete_url,g.autocomplete),a(i.fake_input).on("result",i,function(b,c,e){c&&a("#"+d).addTag(c[0]+"",{focus:!0,unique:g.unique,minChars:g.minChars,maxChars:g.maxChars,limit:g.limit,validationPattern:g.validationPattern})})):void 0!==jQuery.ui.autocomplete&&(a(i.fake_input).autocomplete(k),a(i.fake_input).on("autocompleteselect",i,function(b,c){return a(b.data.real_input).addTag(c.item.value,{focus:!0,unique:g.unique,minChars:g.minChars,maxChars:g.maxChars,limit:g.limit,validationPattern:g.validationPattern}),!1}))}else a(i.fake_input).on("blur",i,function(b){return a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:g.unique,minChars:g.minChars,maxChars:g.maxChars,limit:g.limit,validationPattern:g.validationPattern}),!1});a(i.fake_input).on("keypress",i,function(b){if(e(b))return b.preventDefault(),a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:!0,unique:g.unique,minChars:g.minChars,maxChars:g.maxChars,limit:g.limit,validationPattern:g.validationPattern}),!1}),a(i.fake_input).bind("input",i,function(b){var c=a(b.data.fake_input).val();c=c.replace(/\n/g,""),c=c.replace(/\s/g,"");var d=f(b,c);if(d.length>0){for(var e=0;e<d.length;++e)a(b.data.real_input).addTag(d[e],{focus:!0,unique:g.unique,minChars:g.minChars,maxChars:g.maxChars,limit:g.limit,validationPattern:g.validationPattern});return!1}}),i.removeWithBackspace&&a(i.fake_input).on("keydown",function(b){if(8==b.keyCode&&""===a(this).val()){b.preventDefault();var c=a(this).closest(".tagsinput").find(".tag:last > span").text(),d=a(this).attr("id").replace(/_tag$/,"");a("#"+d).removeTag(encodeURI(c)),a(this).trigger("focus")}}),a(i.fake_input).blur(),i.unique&&a(i.fake_input).keydown(function(b){a(this).removeClass("error")})}}),this},a.fn.tagsInput.updateTagsField=function(c,d){var e=a(c).attr("id");a(c).val(d.join(b[e]))},a.fn.tagsInput.importTags=function(d,e){a(d).val("");var f=a(d).attr("id"),g=e.split(b[f]);for(i=0;i<g.length;++i)a(d).addTag(g[i],{focus:!1,callback:!1,minChars:0,maxChars:null,limit:null,validationPattern:null});if(c[f]&&c[f].onChange){var h=c[f].onChange;h.call(d,d,g[i])}};var d=function(a,b,c){var d=!0;return""===a&&(d=!1),a.length<b.minChars&&(d=!1),null!==b.maxChars&&a.length>b.maxChars&&(d=!1),null!==b.limit&&c.length>=b.limit&&(d=!1),null===b.validationPattern||b.validationPattern.test(a)||(d=!1),d},e=function(b){var c=!1;return 13===b.which||("string"==typeof b.data.delimiter?b.which===b.data.delimiter.charCodeAt(0)&&(c=!0):a.each(b.data.delimiter,function(a,d){b.which===d.charCodeAt(0)&&(c=!0)}),c)},f=function(b,c){if(""===c)return[];var d;return"string"==typeof b.data.delimiter?(d=c.split(b.data.delimiter),d.length>1?d:[]):(a.each(b.data.delimiter,function(a,b){return d=c.split(b),!(d.length>1)&&void(d=[])}),d)}}(jQuery);